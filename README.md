![@mixxtor/adonisjs-shortlink](https://socialify.git.ci/mixxtor/adonisjs-shortlink/image?description=1&descriptionEditable=URL%20shortener%20service%20for%20AdonisJS%20v6.&font=Jost&forks=1&issues=1&logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAJAAAACQCAYAAADnRuK4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAN30lEQVR4nO2de3AbxR3HL0Ap0E6nU9pmOtPHdIbpTGk7VH7FjmMn%2BCE7kDRA6iEF2gDOnSlthhIYOm1ky%2FJDlu2S2BBCHN2ZhJTHhAQI0JZXUwKFDIESGB4pobzCSbqT5Ics7cpPbWcVu3WMdNZJd9o7aT8z339iRfb%2Bfl%2Ft7eO3K4ahUCgUCoVCoVAoFAqFQqFQKBQKhUKhUCg5w6370flNQuQSjocNHA9tLA%2F2cQI4zAnwLZaHIivAYU4AgBMgOi0A8L%2Fhn%2BHX4Nfi%2F8MKcCt%2BD%2FxeG%2B9D55FuF0UPEFqyaXf4RxwPNnM8fJTlwcesAGb%2Bbw5txApg5vR7w4OsG%2Fy2SRi%2FmHTTKWnS6A4v5QTAsTx4mBOgpLVZVEjiBPDQJj7C3nR%2F%2BJuk40JRYHM%2F%2BiLnBms5Ae7nBDBJ0DQooXgwzfHguSYB%2FoobQBeQjhdlFk4AyzgB7uZ4OELcJEKqZoIjLA8H2EFQTDp%2BeQsnwBUcD58kbgYhM7EC%2BCfuOUnHM29ghWgNJ8CjpBOvvZHgG3hGhwf9pGOckzS5YXk8yAZIts56neNhGel45wyN7tGvcTzs12PqbVjxIMYJ4P4bhLFvkI6%2FeUFoSXzGIsAA8YQSEhtfvAS32O3oLNLpMBU38vB7HA9eJp1Aw4gHL3ED8Luk82IKZtdyhognzXgabRLAz0nnx7DY7egcVgCteTXWEdIYG%2FGwv2E%2FOpd0vgzFrwfhd1gBvko8QebR0U27wbdJ580QNLrHf8jy4JQBkmI2ebjB8E%2BYfKbJDUryeZbFaTBLw%2BtjTL6uKLMCCJNOgvkFQNNg5DImn%2BDc8BpWAFPkg58rApMsDzcw%2BQDHRy6n5oG6mCjne6J46QUPIuSDnZtieQBzdkwULyulC4RIfxPBIJ7ZMrkEXobnBPgZ6eDmi1genMqZdSJuAH2BFcArpIOab2IF%2BGpOrFizPNxOOpj5KlYAPYzZZ1yna1vIBzMvxYNY0yBYx5h2f4uHQeJBzHOxAhzG5TGMmcAFULSeBxpGrACOmKrWmnWDJtJBo4JnmoiP3siYgd%2FsDV1IN0ih4RQfTgyMfZ0xOiwPBkkHiwom0y7GyOBldDrrgoZVvNrTsEeGEFqSJ%2Be2zC0eHmMMXAxPPkBUaFG5I%2FWM0aDTdmga4a0lxkhwfLSadFCooEoTwZWMUZi9Ho54UKigCgOBZxkD3c9DPCBUUL2JjHA%2FUfxyJwMEgwqqN5AA7yVqHnwzqaluBqNCCww0jK8GJGYgbhBeTToIVDAzE%2FFgPTkDCfAp0gGgghkaCD5OxDz42lpD3oZKhdQJTBLZZLV2%2BfdYtoqISkxJyZj%2FmgKbBxU3e1Bpqw%2BtbJeRtTuA1m0bRtfdG8ZbELqZCN9jnXUDVbZLn5JOSq4ZyKIgbKxaVwBtuCeEB7%2BaGgjfrp9d9%2BxHZxfZPDOkk5JPBrLME%2B6hruwbQZt4oI2BeBDCp2ey5h%2Br03d1Og3%2F3b4gOvQvgAps5BNqZgNZZrXM7kXr%2B0bij7cmAaIjJ6bQwOGJ9B5ju0Fp1gxU3SkfUttYTgigialYPGgPvhImntBcMJBlVni89Nc3J%2BLvNzWDUN%2FT42n0QvD2rBmosl0S1TTw6rtlNBadOSNw%2Fc%2BEiCc1Vwx01zOhM94zOolQ5yGVJuLho1kzUKndO5lq4362TULB8JnmwcRiCLU%2FNkI8sWY3UPOB4XgsFxKOxpD9YFTNOOjDrJhnbV94aYGKBh7%2F5HTXmoiZGYRue2CIeHLNaqDbHhiKxzAZ%2F5FmVMzEwExWvjSvxinfoKaR65L0QHNMTsfQzXuCxBNsNgNx88aUiRiFM8h%2BIPUeCOsmPvxj%2FQ3k8u9U29jrdvpRZDx5Y6OTMXT9gD8ridHi9dv%2FNvq%2FJB7%2FZCL%2B9%2BP2nfBOZsVAqcZzdW%2FQePti1U75sB6fmBEwg67qkzQxEB4T6GmgXX8PoS1%2FDqLpBR0rfpzobSC1Pfr6%2FhE1A%2Bk%2F6m6gVR3SB%2Bl2u7cmCPp85NA0uqzXl7GBZnQ20MHXImgUfL4hOHl6Gqi%2B24e8I9NJ3wsb%2BI6HzhxTFjV70MZd4VR7oL26G6iizTecroGwWpLMGub4NDiFarq8hjbQ1HTiBoxP6megSzu96CP%2FVNL3UZrVVrbLKe2lsQJ4XncDlbb6opkYKNG6xULe902iyvbUTJQILR8lagAT%2BhiovM2D3hWTz2ZTWVdL6VHGw%2BO6G6ik1TuVqYGw9rwYVgzIsQ%2FH0TK7x1QGCkdnNDdQSYsHvfLBuOLvfejo4iv7y1q8i%2B6d4avx9DdQsxjTwkB4P%2Byx14FiYF44EUVFzeoNNJ0FA2GTHjgWQZv3BtE198jxSQLe69PSQIXNInr2bagYo6eOp763iDdglR9hcFh3AxVquBGKA%2FTcO8oBevIN5QCRMpDtkWFVbVX7e3GbH30tkvEHbOEuvvJYCADdDaRmFToVpdJFK22%2BJhvk6mkgpfUei0a%2Fd7FH%2FGsfpfaIX6hf3BNSGAOBad0NZLFpb6CjixjoviNjhjIQNrxZDWR1BcgaqMAEjzAt12OSDfD1NlCBTYyvN2n5CJv7wCZ%2FjGXhEVbU7MnaIPof76U3iNbbQHj7Qm8DWVIcRP9FxSB6Tr%2FENdakBtElLZ5pLQy09yX9pvF4y0RPA739WXYMZJkbI56MZjyNn68rto%2BQm8aXtnozXki8%2B1nlhUS8aIYXz9JNjN4Ges%2Bj%2FyDaMk9lrR701qfKC4l4cTbVv6WuO%2FE4CF8QpruBVjiMv5Wht4FO%2BrJrIEuqWxmPp1agV9khk7uxo7Jd%2Bjhd8yTawZ6PpNFmqtIYKJl51bw%2FTmS2DWSJ9xyLbKbGELrj4aHU1oNIbaZWdcgvGKmcA04kfs%2FSVo8miUzEqSAZA1k0KtDDZ8wSGsgN%2F6C7gaqd%2Fl1aF0Dhn127M72CMtxrJWLDDvlzr210BzQxEO4FSBnIkuSQgpoCvUJbYgNxbnCV%2Fgbq8N2o9hMzFNGvpBXP1hKx8PzZlX2SYvevJvG4bomkgSyplLSCGbS%2BP3mPnshA%2BEsBdTdQ3Tb%2FtywGKqofPDKmOCA%2F%2FC6M%2Fw1KxedKiUwE%2FkCQNpAlhaJ6pfUqYkX1mJLm1NeClI71tGlwrKfhLhlpgZrEh6AxDGRRONaDx5S4103ZQNk61oOpaJM8mT6z%2B54%2BXZiuhV78t%2FJC2xxK4zA1iVcqHLNk2UBYuJhsYTtxiYnS%2FyF6sLCmy%2F%2BI2kayvH5Hm%2Bt7fMinML6ZKze9ZV9QEwMprTNZCBho%2FuZrfEx5X2DR1ycw0JasGaiuR1qXTiO3PDCEDh6L6HK5Al4%2FejnJkr9%2FbDo%2BKyl3eDQxkFLNtYWQgeKbr8ci8Rin8vqFBmpyg5KsGYixo7OKDXq9y5XbJeQ8NIIGDo%2BhHc%2BF0O0PDp2xp7bmTimh9P67CpsTi1SciF7vgqEXTJlbC3qgA0y2qXHK%2B0gHgUrUxEBNQrQx6waq7w9ejO%2F0Ix0IKjEzA%2FFggtg3GVa0STLpQFCJmRlIgI8xpKh1BfpIB4JKzMxA2dj%2FSsa67SNfLbJpc06MSsy6gYh%2F1QFmVbt8gnQwqMS0DMTxcCdDmroe%2BXrSwaAS0zLQJjcoZIzA8gzLXKnE7BuIh08zRqGuZ2gL6YBQiaq0aRBWMEaizOEdIx0UKjEllbX69D9AqJY6V8BBOjBUYkqydvlbGMNhR2eVOXyAdHCoREWtcHjHGKNS6%2FI3an35ApWoqepcgSbGyKzskN4nHSQqMaEq2qWTjNGxOuWL6FdBiYZToU2M1W3z6X%2FqQgtoqYdoOFU5%2FfqfOtWKlXZ0TnmbN0Q6aFRiXMsd3lH8JYGMmbjcFSwp0uhCTioxbeHN7jU9Q2WMGbG6%2FHY6KxOJqrrT38uYmUs7pNdJBzFfVdku6X9xuN403Hrq%2FHK6zYGyrXKHb2ylXf4ykwvg8ZCa49BUYkYqafFMWe8cvoTJJVa7hlYb9SxZrq33WLtHrmByEatLvgE3kHSQc1UFNg%2Bqdvmzd0SZBDWu4Fatb7unEuPmwbNeJh%2Bocfl3UBOJ2pkHl2j0BLYx%2BYS1O%2FB7eqJDzFj4y2%2BqXXInk4%2Fggny68SpmYp5YTZf%2FFiafsXYPrynW6Pb7fFJxs2e6riewjnT%2BDEF9b6C4zOGji41bU9Nyhzd0WY%2F8U9J5MxQb7ei8Kqf0Ah1ci4qq7JDfru31fYl0vgxLbVfQVtRMx0WWBcITjiqn1EM6P6ZgrStYutzhGyWdNKNohcM3vKY3UEw6L%2BZiPzq7xhkQ8nmWVmgTY9Vd0sGGBpMVgxmJte2%2B76%2FqkN7Mq7oim4gq26RPrF1ybm2IkqS%2B19%2B4vFWKEE%2Buzlru8IXx8SjS8c5Z6rsDN69ok4ZIJ1prlbZ6I7Vdfhc%2BoEk6xnmBtUfeXO7wBczf43hDeObJMGgJ6ZjmJfW98sZVHfK7ZirgL7SJsZWd8jv1Lv8G0vGjzFJvD36l1uV3VbT5PEa8PbbA5kEr2qRgrTPgXtsXXko6XhQFVv8p9IPqLv%2F9%2BEthSBawFdvEWEWbJNZ0B%2FZY75QvIh0XShqssXsuWO0aYqud%2Ficq23ze4hbPlC49zFYRLbN7JyvbJU91p%2FzE5a7gxgY7Opd0%2Byk6UNUpLa11BjfWOP07L%2B2QD1d2yB%2FimV1Zqw%2Fi4n88niqcHVNhYxQ1e2LFzWKspNU7Vdrqi%2BJH0apO6WSV0%2F98ldO%2F0%2BoMXFvtDF1Iul0UCoVCoVAoFAqFQqFQKBQKhUKhUCgUCoXRjP8CYNzut4InEmgAAAAASUVORK5CYII&name=1&owner=1&pattern=Charlie%20Brown&pulls=1&stargazers=1&theme=Auto)

A standalone URL shortener service for AdonisJS v6 applications.

[![npm version](https://badge.fury.io/js/@mixxtor%2Fadonisjs-shortlink.svg)](https://www.npmjs.com/package/@mixxtor/adonisjs-shortlink)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## Features

- ✅ **Standalone Operation** - Run independently on its own domain
- ✅ **Click Tracking** - Monitor shortlink usage statistics
- ✅ **Customizable Slugs** - Use custom or auto-generated slugs
- ✅ **TypeScript Support** - Fully typed for better DX
- ✅ **Easy Integration** - Simple setup with AdonisJS v6
- ✅ **Database Agnostic** - Works with any Lucid-supported database

## Installation

```bash
npm install @mixxtor/adonisjs-shortlink
```

## Setup

### 1. Configure Provider

Add the provider to your `adonisrc.ts`:

```typescript
{
  providers: [
    // ... other providers
    () => import('@mixxtor/adonisjs-shortlink/shortlink_provider'),
  ]
}
```

### 2. Create Configuration File

Create `config/shortlink.ts`:

```typescript
import env from '#start/env'
import { defineConfig } from '@mixxtor/adonisjs-shortlink'

const shortlinkConfig = defineConfig({
  domain: env.get('SHORT_DOMAIN'),
  slugLength: 8,
  trackClicks: true,
  redirectStatusCode: 301,
})

export default shortlinkConfig
```

### 3. Add Environment Variables

Add to your `.env` file:

```env
SHORT_DOMAIN=short.yourdomain.com
```

### 4. Create Migration

Create a new migration file `database/migrations/TIMESTAMP_create_shortlinks_table.ts`:

```typescript
import { BaseSchema } from '@adonisjs/lucid/schema'

export default class extends BaseSchema {
  protected tableName = 'shortlinks'

  async up() {
    this.schema.createTable(this.tableName, (table) => {
      table.increments('id').primary()
      table.string('slug', 255).notNullable().unique().index()
      table.text('original_url').notNullable()
      table.integer('clicks').defaultTo(0).notNullable()
      table.jsonb('metadata').nullable()

      table.timestamp('created_at', { useTz: true }).notNullable()
      table.timestamp('updated_at', { useTz: true }).notNullable()
    })
  }

  async down() {
    this.schema.dropTable(this.tableName)
  }
}
```

### 5. Run Migration

```bash
node ace migration:run
```

## Usage

### Basic Usage

```typescript
import shortlinkService from '@mixxtor/adonisjs-shortlink/services/main'
import shortlinkConfig from '#config/shortlink'

// Create a shortlink
const shortlink = await shortlinkService.create('https://example.com/very/long/url')
console.log(shortlinkService.getShortUrl(shortlink.slug))
// Output: https://short.yourdomain.com/aBcD1234
```

### With Custom Slug

```typescript
const shortlink = await shortlinkService.create(
  'https://example.com/sale',
  'summer-sale' // Custom slug
)
// Output: https://short.yourdomain.com/summer-sale
```

### Get or Create (Avoid Duplicates)

```typescript
// Returns existing shortlink if URL already exists
const shortlink = await shortlinkService.getOrCreate('https://example.com/url')
```

### With Metadata

```typescript
const shortlink = await shortlinkService.create('https://example.com/product', undefined, {
  campaign: 'Black Friday',
  source: 'email',
})
```

### Controller Usage

Create a controller `app/controllers/shortlink_controller.ts`:

```typescript
import { inject } from '@adonisjs/core'
import { HttpContext } from '@adonisjs/core/http'
import { ShortlinkController as BaseController } from '@mixxtor/adonisjs-shortlink'
import shortlinkConfig from '#config/shortlink'

@inject()
export default class ShortlinkController extends BaseController {
  constructor() {
    super(shortlinkConfig)
  }
}
```

### Routes

Add routes in `start/routes.ts`:

```typescript
import router from '@adonisjs/core/services/router'

const ShortlinkController = () => import('#controllers/shortlink_controller')

// Main redirect route
router.get('/:slug', [ShortlinkController, 'redirect']).as('shortlink.redirect')

// API routes (optional)
router
  .group(() => {
    router.post('/shortlinks', [ShortlinkController, 'store']).as('shortlink.store')
    router.get('/shortlinks/:slug/stats', [ShortlinkController, 'show']).as('shortlink.show')
    router.delete('/shortlinks/:slug', [ShortlinkController, 'destroy']).as('shortlink.destroy')
  })
  .prefix('/api')
```

## API Reference

### ShortlinkService

#### `create(originalUrl, customSlug?, metadata?)`

Create a new shortlink.

```typescript
const shortlink = await shortlinkService.create(
  'https://example.com/url',
  'custom-slug', // Optional
  { key: 'value' } // Optional
)
```

#### `getBySlug(slug)`

Get shortlink by slug.

```typescript
const shortlink = await shortlinkService.getBySlug('aBcD1234')
```

#### `getByOriginalUrl(url)`

Get shortlink by original URL.

```typescript
const shortlink = await shortlinkService.getByOriginalUrl('https://example.com/url')
```

#### `getOrCreate(originalUrl, metadata?)`

Get existing or create new shortlink.

```typescript
const shortlink = await shortlinkService.getOrCreate('https://example.com/url')
```

#### `delete(slug)`

Delete a shortlink.

```typescript
const deleted = await shortlinkService.delete('aBcD1234')
```

#### `getShortUrl(slug, domain?)`

Build full short URL.

```typescript
const url = shortlinkService.getShortUrl('aBcD1234')
// Returns: https://short.yourdomain.com/aBcD1234
```

## Configuration Options

| Option               | Type         | Default        | Description               |
| -------------------- | ------------ | -------------- | ------------------------- |
| `domain`             | `string`     | **required**   | Short URL domain          |
| `slugLength`         | `number`     | `8`            | Length of generated slugs |
| `trackClicks`        | `boolean`    | `true`         | Enable click tracking     |
| `redirectStatusCode` | `301 \| 302` | `301`          | HTTP redirect status      |
| `connection`         | `string`     | `'pg'`         | Database connection       |
| `tableName`          | `string`     | `'shortlinks'` | Database table name       |

## Integrating with Models

You can integrate shortlinks with your models using hooks:

```typescript
import { beforeSave, BaseModel } from '@adonisjs/lucid/orm'
import shortlinkService from '@mixxtor/adonisjs-shortlink/services/main'
import shortlinkConfig from '#config/shortlink'

export default class Product extends BaseModel {
  @column()
  declare url: string

  @column()
  declare shortUrl: string | null

  @beforeSave()
  static async generateShortlink(product: Product) {
    if (product.$isDirty('url') && product.url) {
      const shortlink = await shortlinkService.getOrCreate(product.url)
      product.shortUrl = service.getShortUrl(shortlink.slug)
    }
  }
}
```

## Production Setup

For production deployment with a dedicated short domain:

### 1. DNS Configuration

Create a DNS record:

```
Type: A or CNAME
Name: short
Value: your-server-ip or main-domain.com
```

### 2. Web Server Configuration

**Nginx Example:**

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name short.yourdomain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://localhost:3333;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 3. SSL Certificate

```bash
sudo certbot --nginx -d short.yourdomain.com
```

## TypeScript Support

The package includes full TypeScript definitions:

```typescript
import type {
  ShortlinkConfig,
  ShortlinkAttributes,
  CreateShortlinkPayload,
  ShortlinkServiceContract,
} from '@mixxtor/adonisjs-shortlink/types'
```

## Testing

```bash
npm test
```

## License

MIT License - see LICENSE file for details

## Author

**Mixxtor**

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## Support

For issues and feature requests, please use the [GitHub issues page](https://github.com/mixxtor/adonisjs-shortlink/issues).
